'use strict';
var mic, cols, rows
var scl = 10
var width = 1000
var height = 1000
var flying = 0



// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------
// -------------------------------------------------------------------------------------------------------------------------------------






function setup() {
  // start mic
  mic = new p5.AudioIn()
  mic.start()

  // Créer canvas et ajoute background
  createCanvas(1000, 1000, WEBGL)


  // Définit le nombre de colonnes en fonction du scale et de la taille du canvas
  cols = width / scl
  rows = height / scl
}

function draw() {
  // Prend le volume du micro entre 0 et 1 et le map (influe donc sur le min et max de la hauteur des vaguess)
  var vol = mic.getLevel();
  var voloff = map(vol, 0, 1, 50, 500)
  console.log(voloff)

  var terrain = []
  //Flying définit la vitesse a laquelle on se déplace dans le bruit de perlin et donc la vitesse de génération donc de mouvement

  flying -= map(vol, 0, 1, 0.005, 0.1)
  var yoff = flying
  //console.log(yoff)
  background(0)
  // xoff et yoff et leur variation définissent l'espace donc la randomness entre 2 points du noise 
  for (var y = 0; y <= rows; y++) {
    var xoff = 0
    var tmp = []
    for (var x = 0; x <= cols; x++) {

      // Définit le minimum et maximum du mapping du noise
      tmp.push(map(noise(xoff, yoff), 0, 1, -voloff, voloff))
      xoff += .1


    }
    yoff += 0.1
    terrain.push(tmp)
  }
  // Rotate en 3D et recentre le canvas 
  rotateZ(PI / 2)
  rotateX(PI / 3)
  translate(-width / 2, -height / 2)



  // Crée la grille de terrain
  for (var y = 0; y <= rows; y++) {


    // Crée une bande de triangle qui forment des carrés en leur donnant le Z pour la hauteur
    beginShape(TRIANGLE_STRIP)
    for (var x = 0; x <= cols; x++) {
      //fill(255)
      //stroke(0)
      noFill()
      if (y <= rows / 3) {

        stroke('#ED2939')
      } else if (y <= rows * 2 / 3) {
        stroke(255)
      } else {
        stroke('#002395')
      }
      //vertex(x,y,z)
      vertex(x * scl, y * scl, terrain[x][y])
      vertex(x * scl, (y + 1) * scl, terrain[x][y + 1])
    }
    endShape()
  }


}